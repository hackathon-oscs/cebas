<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//BR"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
	<ui:define name="corpo">
		<h:form id="formulario" binding="#{permissaoMB.form}"
			rendered="#{permissaoMB.permissaoAcesso.acesso == 's'}">
			<p:panel id="panel" header="Autorizar permissão ao usuário">
				<h:panelGrid columns="2" >
					<p:selectOneMenu id="perfil" value="#{permissaoMB.perfilSelecionado}" converter="perfilConverter">
						<f:selectItem itemLabel="--Selecione--" itemValue="" />
						<f:selectItems value="#{permissaoMB.listaPerfis}" var="p"
							itemLabel="#{p.nome}" itemValue="#{p}" />
						<p:ajax listener="#{permissaoMB.carregaModulo()}" update="panel tabview" process="@this, perfil" />
					</p:selectOneMenu>
				</h:panelGrid>
				<br/>
				
				<p:tabView id="tabview" rendered="#{not empty permissaoMB.perfilSelecionado}" >
					<p:tab title="Permissão de acesso">
						<p:tree id="tablemodulo" value="#{permissaoMB.rootModulo}" var="modulo" 
							 selection="#{permissaoMB.selectedNodeModulos}" selectionMode="checkbox">
							<p:treeNode>
								<h:outputText value="#{modulo.nome}" /> 
							</p:treeNode>
						</p:tree>
						<p:commandButton value="Salvar" action="#{permissaoMB.salvarPermissaoAcesso()}" ajax="false"/>
					</p:tab>
					<p:tab title="Ações">
						<p:contextMenu for="tablepermissao">  
					        <p:menuitem value="Alterar permissão" actionListener="#{permissaoMB.editar()}" update=":formulario:panelpermissao" 
					        	oncomplete="PF('permissaoDialog').show()" icon="ui-icon-pencil"/>
					    </p:contextMenu>
						
						<p:treeTable id="tablepermissao" value="#{permissaoMB.root}" var="element" 
							emptyMessage="Nenhum módulo cadastrado para este perfil" selection="#{permissaoMB.selectedNode}" selectionMode="single">
							<f:facet name="header">Lista de Módulos</f:facet>
							<p:column headerText="Nome">
								<h:outputText value="#{element.nome}" />
							</p:column>
							<p:column headerText="URL">
								<h:outputText value="#{element.url}" />
							</p:column>
							<p:column headerText="Ordem">
								<h:outputText value="#{element.ordem}" />
							</p:column>
						</p:treeTable>
					</p:tab>
				</p:tabView>
			</p:panel>
			
			<p:dialog header="Alterar Permissão..." showEffect="fade" widgetVar="permissaoDialog" modal="true" resizable="false">  
		        <p:outputPanel id="panelpermissao">  
		            <h:panelGrid id="panelCadastro" columns="2" cellpadding="5" rendered="#{not empty permissaoMB.permissaoSelecionada}">  
		                <h:outputLabel value="Acesso: " />  
		                <p:selectOneRadio id="acesso" value="#{permissaoMB.permissaoSelecionada.acesso}">
		                	<f:selectItem itemLabel="Sim" itemValue="s"/>
		                	<f:selectItem itemLabel="Não" itemValue="n"/>
		                </p:selectOneRadio>
		  
		                <h:outputLabel value="Incluir: " />  
		                <p:selectOneRadio id="incluir" value="#{permissaoMB.permissaoSelecionada.inclusao}">
		                	<f:selectItem itemLabel="Sim" itemValue="s"/>
		                	<f:selectItem itemLabel="Não" itemValue="n"/>
		                </p:selectOneRadio> 
		                
		                <h:outputLabel value="Alterar: " />  
		                <p:selectOneRadio id="alterar" value="#{permissaoMB.permissaoSelecionada.alteracao}">
		                	<f:selectItem itemLabel="Sim" itemValue="s"/>
		                	<f:selectItem itemLabel="Não" itemValue="n"/>
		                </p:selectOneRadio>
		                
		                <h:outputLabel value="Excluir: " />  
		                <p:selectOneRadio id="excluir" value="#{permissaoMB.permissaoSelecionada.exclusao}">
		                	<f:selectItem itemLabel="Sim" itemValue="s"/>
		                	<f:selectItem itemLabel="Não" itemValue="n"/>
		                </p:selectOneRadio>
		                
		                <h:outputLabel value="Executar: " />  
		                <p:selectOneRadio id="executar" value="#{permissaoMB.permissaoSelecionada.execucao}">
		                	<f:selectItem itemLabel="Sim" itemValue="s"/>
		                	<f:selectItem itemLabel="Não" itemValue="n"/>
		                </p:selectOneRadio>
		            </h:panelGrid>  
		            <p:commandButton value="Todos SIM" actionListener="#{permissaoMB.todosSim()}" update="panelCadastro" icon="ui-icon-plus"/>
		            <p:commandButton value="Todos NÃO" actionListener="#{permissaoMB.todosNao()}" update="panelCadastro" icon="ui-icon-minus"/>
		            <br/><br/>
		            <p:commandButton value="Salvar" actionListener="#{permissaoMB.salvar()}" oncomplete="PF('permissaoDialog').hide();" icon="ui-icon-disk"/>
		            <p:commandButton value="Fechar" oncomplete="PF('permissaoDialog').hide();" icon="ui-icon-closethick"/>
		        </p:outputPanel>  
		    </p:dialog>
		</h:form>
	</ui:define>
</ui:composition>