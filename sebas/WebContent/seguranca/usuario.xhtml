<ui:composition template="/template/template.xhtml" 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
	<ui:define name="corpo">
		<h:form id="lista" rendered="#{usuarioMB.utilController.statusListing and usuarioMB.permissao.acesso == 's'}">
			<p:panel id="panelLista" header="Usuários">
				<p:commandButton ajax="false" icon="ui-icon-document" 
					value="#{texto.botao_novo_registro}" 
					title="#{texto.botao_novo_registro_desc}" 
					immediate="true"
					action="#{usuarioMB.novo()}" rendered="#{usuarioMB.permissao.inclusao == 's'}"/>
				<br/><br/>
				
				<p:dataTable id="tabelaUsuario" value="#{usuarioMB.listaUsuarios}" 
					paginator="true" var="item" filterEvent="enter"
					rows="#{texto.quantidade_itens_padrao_listagem}"
					paginatorTemplate="#{texto.paginatorTemplate}"
					rowsPerPageTemplate="#{texto.rowsPerPageTemplate}" 
					paginatorPosition="#{texto.paginatorPosition}"
					emptyMessage="#{texto.nenhum_registro_encontrado}">

					<p:column headerText="Nome" filterBy="#{item.nome}" sortBy="#{item.nome}" filterMatchMode="contains">
						<h:outputText value="#{item.nome}" />
					</p:column>
					<p:column headerText="Login" filterBy="#{item.login}" sortBy="#{item.login}" filterMatchMode="contains">
						<h:outputText value="#{item.login}" />
					</p:column>
					<p:column headerText="Perfil">
						<ui:repeat value="#{item.perfis}" var="p">
							<p>#{p.nome}</p>
						</ui:repeat>
					</p:column>

					<p:column styleClass="tamanhoCampoAcoesTabela" headerText="#{texto.texto_para_coluna_acoes}">
						<p:commandLink ajax="false" title="#{texto.acao_editar_registro}" 
							rendered="#{usuarioMB.permissao.alteracao == 's'}"
							action="#{usuarioMB.editar()}">
							<h:graphicImage value="/resources/imagens/icons/edit.png" />
							<f:setPropertyActionListener target="#{usuarioMB.usuario}"
								value="#{item}" />
						</p:commandLink>
						<p:spacer width="10px" />
						<p:commandLink ajax="false" update="formLista" rendered="#{usuarioMB.permissao.exclusao == 's'}"
							title="#{texto.acao_desativar_registro}"
							action="#{usuarioMB.preparaParaDesativar()}">
							<h:graphicImage value="/resources/imagens/icons/remover.png" />
							<f:setPropertyActionListener target="#{usuarioMB.usuario}"
								value="#{item}" />
						</p:commandLink>
						
					</p:column>
				</p:dataTable>
			</p:panel>
		</h:form>

		<h:form id="formulario" binding="#{usuarioMB.form}"
			rendered="#{!usuarioMB.utilController.statusListing and !usuarioMB.utilController.statusFiltering}"
			styleClass="edit">
			<p:panel id="panelFormulario" header="Cadastro de Usuário">
				<h:panelGrid columns="2" id="panel" columnClasses="tamanho130" rendered="#{usuarioMB.utilController.statusInserting}">
					<h:outputLabel value="Senha:" for="senha">
						<span class="required">*</span>
					</h:outputLabel>
					<p:password id="senha" value="#{usuarioMB.usuario.senha}"
						disabled="#{usuarioMB.utilController.statusViewing || usuarioMB.utilController.statusRemoving}"  
						required="true" requiredMessage="#{texto.preencha_o_campo_x} Senha"
						styleClass="maxCampoSenha" maxlength="10"
						feedback="true" promptLabel="Digite a senha" weakLabel="Fraco" goodLabel="Bom" strongLabel="Forte"
						match="confirSenha" inline="true" redisplay="true"
						validatorMessage="#{texto.senha_diferente}"  />
					
					<h:outputLabel value="Confirmar senha:" for="confirSenha">
						<span class="required">*</span>
					</h:outputLabel>
					<p:password id="confirSenha" value="#{usuarioMB.usuario.senha}"
						disabled="#{usuarioMB.utilController.statusViewing || usuarioMB.utilController.statusRemoving}"
						required="true" requiredMessage="#{texto.preencha_o_campo_x} Confirmar senha"
						redisplay="true" styleClass="maxCampoSenha" maxlength="10" />
				</h:panelGrid>
				
				<h:panelGrid columns="2" columnClasses="tamanho130">
					<h:outputLabel value="Login:" for="login">
						<span class="required">*</span>
					</h:outputLabel>
					<p:inputText id="login"
						disabled="#{usuarioMB.utilController.statusViewing || usuarioMB.utilController.statusRemoving || usuarioMB.utilController.statusEditing}"
						value="#{usuarioMB.usuario.login}" 
						styleClass="maxCampoTexto" maxlength="255"
						required="true" requiredMessage="#{texto.preencha_o_campo_x} Login">
					</p:inputText>				
				
					<h:outputLabel value="Nome:" for="nome">
						<span class="required">*</span>
					</h:outputLabel>
					<p:inputText id="nome"
						disabled="#{usuarioMB.utilController.statusViewing || usuarioMB.utilController.statusRemoving}"
						value="#{usuarioMB.usuario.nome}" styleClass="maxCampoTexto" maxlength="255" 
						required="true" requiredMessage="#{texto.preencha_o_campo_x} Nome" />
					
					<h:outputLabel value="E-mail:" for="email"></h:outputLabel>
					<p:inputText id="email"
						disabled="#{usuarioMB.utilController.statusViewing || usuarioMB.utilController.statusRemoving}"
						value="#{usuarioMB.usuario.email}" styleClass="maxCampoTexto" maxlength="255"
						validatorMessage="#{texto.endereco_invalido_no_campo_x} E-mail" />
				</h:panelGrid>
				<br/>
				
				<p:pickList id="pickList" value="#{usuarioMB.perfis}" var="p"
					disabled="#{usuarioMB.utilController.statusViewing || usuarioMB.utilController.statusRemoving}"
					addLabel="Adicionar" addAllLabel="Adicionar todos" removeLabel="Remover" removeAllLabel="Remover todos"
		            itemLabel="#{p.nome}" itemValue="#{p}" converter="perfilConverter">
					<f:facet name="sourceCaption">Perfis Disponíveis</f:facet>  
			        <f:facet name="targetCaption">Perfis Escolhidos</f:facet>					
	            </p:pickList>

				<h:outputText value="#{texto.campos_obrigatorios}" escape="false" />
				
				<p:commandButton ajax="false" icon="ui-icon-disk" value="#{texto.botao_salvar_registro}"
					title="#{texto.botao_salvar_registro_desc}" action="#{usuarioMB.salvar()}"
					rendered="#{usuarioMB.utilController.statusInserting || usuarioMB.utilController.statusEditing}" />
				<p:spacer height="5px" />
				<p:commandButton ajax="false" icon="ui-icon-trash" 
					value="#{texto.botao_desativar_registro}" title="#{texto.botao_desativar_registro_desc}" 
					action="#{usuarioMB.desativar()}"
					rendered="#{usuarioMB.utilController.statusRemoving}" />
				<p:spacer height="5px" />
				<p:commandButton ajax="false" icon="ui-icon-closethick"
					value="#{texto.botao_voltar}" title="#{texto.botao_voltar_desc}" 
					action="#{usuarioMB.voltarLista()}"
					immediate="true" />
			</p:panel>
		</h:form>

	</ui:define>
</ui:composition>